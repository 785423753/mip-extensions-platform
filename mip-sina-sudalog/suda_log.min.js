define(function(){function e(){function e(e){e&&e()}function t(){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){u=(new Date).getTime(),document.removeEventListener("DOMContentLoaded",arguments.callee,!1)},!1):document.getElementById&&(document.write('<script id="ie-domReady" defer=\'defer\'src="//:"></script>'),document.getElementById("ie-domReady").onreadystatechange=function(){"complete"===this.readyState&&(u=(new Date).getTime(),this.onreadystatechange=null,this.parentNode.removeChild(this))})}function n(e){function t(e,t){var n=b.getElementsByName(e),r=t>0?t:0;return n.length>r?n[r].content:""}function n(){for(var e=b.getElementsByName("sudameta"),t=[],n=0;n<e.length;n++){var r=e[n].content;if(r)if(-1!=r.indexOf(";"))for(var i=r.split(";"),o=0;o<i.length;o++){var a=l(i[o]);a&&t.push(a)}else t.push(r)}return t.join("|")}function r(e,t,n,r){if(""==e)return"";r=""==r?"=":r,t+=r;var i=e.indexOf(t);if(0>i)return"";i+=t.length;var o=e.indexOf(n,i);return i>o&&(o=e.length),e.substring(i,o)}function i(e){return void 0==e||""==e?"":r(b.cookie,e,";","")}function o(e,t,n,r){if(null!=t)if((void 0==r||null==r)&&(r="sina.cn"),void 0==n||null==n||""==n)b.cookie=e+"="+t+";domain="+r+";path=/";else{var i=new Date,o=i.getTime();o+=864e5*n,i.setTime(o),o=i.getTime(),b.cookie=e+"="+t+";domain="+r+";expires="+i.toUTCString()+";path=/"}}function a(e,t,n){var r=e;return null==r?!1:(t=t||"click","function"==(typeof n).toLowerCase()?(r.attachEvent?r.attachEvent("on"+t,n):r.addEventListener?r.addEventListener(t,n,!1):r["on"+t]=n,!0):void 0)}function d(){if(null!=window.event)return window.event;if(window.event)return window.event;for(var e,t=arguments.callee.caller,n=0;null!=t&&40>n;){if(e=t.arguments[0],e&&(e.constructor==Event||e.constructor==MouseEvent||e.constructor==KeyboardEvent))return e;n++,t=t.caller}return e}function f(e){return e=e||d(),e.target||(e.target=e.srcElement,e.pageX=e.x,e.pageY=e.y),"undefined"==typeof e.layerX&&(e.layerX=e.offsetX),"undefined"==typeof e.layerY&&(e.layerY=e.offsetY),e}function l(e){if("string"!=typeof e)throw"trim need a string as parameter";for(var t=e.length,n=0,r=/(\u3000|\s|\t|\u00A0)/;t>n&&r.test(e.charAt(n));)n+=1;for(;t>n&&r.test(e.charAt(t-1));)t-=1;return e.slice(n,t)}function g(e){return"[object Array]"===Object.prototype.toString.call(e)}function p(e,t){for(var n=l(e).split("&"),r={},i=function(e){return t?decodeURIComponent(e):e},o=0,a=n.length;a>o;o++)if(n[o]){var u=n[o].split("="),s=u[0],c=u[1];u.length<2&&(c=s,s="$nullName"),r[s]?(1!=g(r[s])&&(r[s]=[r[s]]),r[s].push(i(c))):r[s]=i(c)}return r}function m(e){v(e)}function v(e){var t=new Image;SUDA.img=t,t.src=e}function h(e,t,n,r){SUDA.sudaCount++;var i=S+[H.V(),H.CI(),H.PI(n,r),H.UI(),H.MT(),H.EX(e,t),H.R()].join("&");v(i)}function w(e,t,n){0==SUDA.sudaCount&&h(e,t,n)}function y(e,t,n){n=n?escape(n):"";var r="UATrack||"+i(M)+"||"+i(B)+"||"+Y.userNick()+"||"+e+"||"+t+"||"+G.referrer()+"||"+n+"||",o=U+r+"&gUid_"+(new Date).getTime();m(o)}function C(e,t,n){n=n?escape(n):"";var r="UATrack||"+i(z)+"||"+i(B)+"||"+Y.userNick()+"||"+e+"||"+t+"||"+G.referrer()+"||"+n+"||",o=U+r+"&gUid_"+(new Date).getTime();m(o)}function T(e){var t,n=f(e),r=n.target,i="",o="";if(null!=r&&r.getAttribute&&!r.getAttribute("suda-uatrack")&&!r.getAttribute("suda-data"))for(;null!=r&&r.getAttribute&&0==(!!r.getAttribute("suda-uatrack")||!!r.getAttribute("suda-data"));){if(r==b.body)return;r=r.parentNode}null!=r&&null!=r.getAttribute&&(i=r.getAttribute("suda-uatrack")||r.getAttribute("suda-data")||"",i&&(t=p(i),"a"==r.tagName.toLowerCase()&&(o=r.href),t.key&&SUDA.uaTrack&&SUDA.uaTrack(t.key,t.value||t.key,o)))}var k=window,b=document,I=navigator,_=(I.userAgent,k.screen),A=k.location.href,x="https:"==window.location.protocol?"sbeacon.sina.com.cn":"beacon.sina.com.cn",S=c+x+"/a.gif?",U=c+x+"/e.gif?",D="",E="";startTime="",readyTime="",ext1="",ext2="",currTime=parseInt((new Date).getTime()),"undefined"!=typeof sudaLogConfig&&(D=void 0!==sudaLogConfig.uId?sudaLogConfig.uId:"",E=void 0!==sudaLogConfig.url?sudaLogConfig.url:"","undefined"!=typeof globalConfig&&(startTime=void 0!==globalConfig.startTime?globalConfig.startTime:s),ext1=void 0!==sudaLogConfig.ext1?sudaLogConfig.ext1:"",ext2=void 0!==sudaLogConfig.ext2?sudaLogConfig.ext2:""),D=D||e||"",onloadTime=currTime-startTime,readyTime=u-startTime;var L="MT="+(n()||"");if("undefined"!=typeof sudaLogConfig&&"undefined"!=typeof sudaLogConfig.prevPageClickTime&&""!==sudaLogConfig.prevPageClickTime){var N=void 0!==sudaLogConfig.prevPageClickTime?sudaLogConfig.prevPageClickTime:0,O=startTime-N;L+="|mperform:1|starttime:"+N+"|endtime:"+startTime+"|clicktime:"+O}var j=b.referrer.toLowerCase(),M="SINAGLOBAL",B="Apache",P="ULV",R="SUP",z="ustat",V="",X="",Z="",F={screenSize:function(){return _.width+"x"+_.height},colorDepth:function(){return _.colorDepth||""},appCode:function(){return I.appCodeName||""},appName:function(){return I.appName.indexOf("Microsoft Internet Explorer")>-1?"MSIE":I.appName},cpu:function(){return I.cpuClass||I.oscpu||""},platform:function(){return I.platform||""},jsVer:function(){var e,t,n,r=1,i=I.appName.indexOf("Microsoft Internet Explorer")>-1?"MSIE":I.appName,o=I.appVersion;return"MSIE"==i?(t="MSIE",e=o.indexOf(t),e>=0&&(n=window.parseInt(o.substring(e+5)),n>=3&&(r=1.1,n>=4&&(r=1.3)))):("Netscape"==i||"Opera"==i||"Mozilla"==i)&&(r=1.3,t="Netscape6",e=o.indexOf(t),e>=0&&(r=1.5)),r},network:function(){var e="";e=I.connection&&I.connection.type?I.connection.type:e;try{b.body.addBehavior("#default#clientCaps"),e=b.body.connectionType}catch(t){e="unkown"}return e},language:function(){return I.systemLanguage||I.language||""},timezone:function(){return(new Date).getTimezoneOffset()/60||""},flashVer:function(){return""},javaEnabled:function(){var e,t,n=I.plugins,r=I.javaEnabled();if(1==r)return 1;if(n&&n.length){for(var i in n)if(e=n[i],null!=e.description){if(null!=r)break;t=e.description.toLowerCase(),-1==t.indexOf("java plug-in")||(r=parseInt(e.version))}}else window.ActiveXObject&&(r=null!=new ActiveXObject("JavaWebStart.IsInstalled"));return r?1:0}},G={pageId:function(){return""},sessionCount:function(){return""},excuteCount:function(){return SUDA.sudaCount},referrer:function(){var e=/^[^\?&#]*.swf([\?#])?/;if(""==j||j.match(e)){var t=r(A,"ref","&","");if(""!=t)return escape(t)}return escape(j)},isHomepage:function(){var e="";try{b.body.addBehavior("#default#homePage"),e=b.body.isHomePage(A)?"Y":"N"}catch(t){e="unkown"}return e},PGLS:function(){return t("stencil")||""},ZT:function(){var e=t("subjectid");return e.replace(",","."),e.replace(";",","),escape(e)},mediaType:function(){return n()||""},domCount:function(){return b.getElementsByTagName("*").length||""},iframeCount:function(){return b.getElementsByTagName("iframe").length},onloadTime:onloadTime,readyTime:readyTime,webUrl:E,ch:function(){return window.__docConfig?__docConfig.__domain:""},PE:function(){var e=document.getElementsByName("sudameta")[0];return e?e.content:""}},Y={visitorId:function(){if(""!=M){var e=i(M);if(""==e){e=i(B);var t=3650;o(M,e,t)}return e}return""},sessionId:function(){var e=i(B);if(""==e){var t=new Date;e=1e13*Math.random()+"."+t.getTime(),o(B,e)}return e},flashCookie:function(e){return""},lastVisit:function(){var e,t=i(B),n=i(P),r=n.split(":"),a="";if(r.length>=6)if(t!=r[4]){e=new Date;var u=new Date(window.parseInt(r[0]));r[1]=window.parseInt(r[1])+1,e.getMonth()!=u.getMonth()?r[2]=1:r[2]=window.parseInt(r[2])+1,(e.getTime()-u.getTime())/864e5>=7?r[3]=1:e.getDay()<u.getDay()?r[3]=1:r[3]=window.parseInt(r[3])+1,a=r[0]+":"+r[1]+":"+r[2]+":"+r[3],r[5]=r[0],r[0]=e.getTime(),o(P,r[0]+":"+r[1]+":"+r[2]+":"+r[3]+":"+t+":"+r[5],360)}else a=r[5]+":"+r[1]+":"+r[2]+":"+r[3];else e=new Date,a=":1:1:1",o(P,e.getTime()+a+":"+t+":",360);return a},userNick:function(){if(""!=V)return V;var e=unescape(i(R)),t="",n="",o=D,a="",u="";return""!=e&&(t=r(e,"ag","&",""),n=r(e,"user","&",""),D=r(e,"uid","&",""),a=r(e,"sex","&",""),u=r(e,"dob","&","")),V=t+":"+n+":"+o+":"+a+":"+u},userOrigin:function(){return""},advCount:function(){return""},subp:function(){return i("SUBP")}},H={CI:function(){var e=["sz:"+F.screenSize(),"dp:"+F.colorDepth(),"ac:"+F.appCode(),"an:"+F.appName(),"cpu:"+F.cpu(),"pf:"+F.platform(),"jv:"+F.jsVer(),"ct:"+F.network(),"lg:"+F.language(),"tz:"+F.timezone(),"fv:"+F.flashVer(),"ja:"+F.javaEnabled()];return"CI="+e.join("|")},PI:function(e,t){var n=G.webUrl;e&&(n=escape(e));var r=["pid:"+G.pageId(),"st:"+G.sessionCount(),"et:"+G.excuteCount(),"ref:"+(t||G.referrer()),"hp:"+G.isHomepage(),"PGLS:"+G.PGLS(),"ZT:"+G.ZT(),"MT:","keys:","dom:"+G.domCount(),"ifr:"+G.iframeCount(),"nld:"+G.onloadTime,"drd:"+G.readyTime,"url:"+n,"ch:"+G.ch()];return"PI="+r.join("|")},UI:function(){var e=["vid:"+Y.visitorId(),"sid:"+Y.sessionId(),"lv:"+Y.lastVisit(),"un:"+Y.userNick(),"uo:"+Y.userOrigin(),"ae:"+Y.advCount(),"su:"+Y.subp(),"lu:","si:","rs:0","dm:0"];return"UI="+e.join("|")},EX:function(e,t){return e=null!=e?e||"":X,t=null!=t?t||"":Z,"EX=ex1:"+e+"|ex2:ustat-"+i(z)+(t?","+t:"")},MT:function(){return L},V:function(){return"V=2.3.1"},R:function(){return"gUid_"+(new Date).getTime()}};window.SUDA=window.SUDA||[],SUDA.sudaCount=SUDA.sudaCount||0,SUDA.log=function(){h.apply(null,arguments)},SUDA.uaTrack=function(){y.apply(null,arguments)},SUDA.uaTrackLike=function(){C.apply(null,arguments)},a(b.body,"click",T),w(ext1,ext2)}function r(e,t){t=t||"encode";for(var n=["a","B","X","M","Z","Y","Q","c","I","p"],r="",i=0,o=e.length;o>i;i++)r+="encode"==t?n[parseInt(e[i])]:n.indexOf(e[i]);return r}function i(e){e.data=e.data||{},e.timeout=e.timeout||0,e.callback=e.callback||"callback";var t="jsonp_"+Math.random();t=t.replace(".",""),window[t]=function(n){clearTimeout(u),e.success&&e.success(n),e.complete&&e.complete(),a.removeChild(o),window[t]=null},e.data[e.callback]=t;var n=[];for(var r in e.data)n.push(r+"="+encodeURIComponent(e.data[r]));var i="&"+n.join("&"),o=document.createElement("script");o.src=e.url+i;var a=document.getElementsByTagName("head")[0];if(a.appendChild(o),e.timeout)var u=setTimeout(function(){e.error&&e.error(),e.complete&&e.complete(),a.removeChild(o),window[t]=null},e.timeout)}function o(e){document.cookie=e+"=;expires=Fri, 31 Dec 1999 23:59:59 GMT;path=/;domain=.sina.cn"}function a(e,t,n,r){if(""==e)return"";r=""==r?"=":r,t+=r;var i=e.indexOf(t);if(0>i)return"";i+=t.length;var o=e.indexOf(n,i);return i>o&&(o=e.length),e.substring(i,o)}var u="",s=(new Date).getTime();t();var c="https:"==window.location.protocol?"https://":"http://";window.checkLogin=function(){if(getCookie("SUBP")){var e=f.decode(getCookie("SUBP"));if("object"==typeof e)if("0"===e.status)var t=!0;else var t=!1;else var t=!1}else var t=!1;return t},window.getUserInfo=function(e,t,n){if(window.userInfo)return void(e&&e(window.userInfo));if(t=t||!1,!window.checkLogin()&&!n)return o("sina_ucode"),window.userInfo=!1,void(e&&e({}));if(e&&t){var a=getCookie("sina_ucode");if(a)return e({uid:r(a,"decode")})}if(window.getUserInfo.aFn||(window.getUserInfo.aFn=[]),window.getUserInfo.aFn.push(e),!(window.getUserInfo.aFn.length>1)){var u=c+"passport.sina.cn/sso/islogin?";-1==u.indexOf("?")&&(u+="?");var s=new Date,f={random:Math.random(),time:s.getTime()};i({success:function(e){return e.data=e.data||{},e.data.uid?(e.data.uname=e.data.nick,e.data.userface=e.data.portrait_url,e.data.uid&&(e.data.islogin=1),e.data.uid&&d("sina_ucode",r(e.data.uid),240,"/",".sina.cn"),window.userInfo=e.data,void(window.getUserInfo.aFn.length>0&&window.getUserInfo.aFn.forEach(function(t){"function"==typeof t&&t(e.data)}))):(o("SUBP"),!1)},error:function(){e({})},url:u,data:f,timeout:3e3})}},window.getCookie=function(e){return void 0==e||""==e?!1:a(document.cookie,e,";","")};var d=function(e,t,n,r,i,o){var a=[];if(a.push(e+"="+escape(t)),n){var u=new Date,s=u.getTime()+36e5*n;u.setTime(s),a.push("expires="+u.toGMTString())}r&&a.push("path="+r),i&&a.push("domain="+i),o&&a.push(o),document.cookie=a.join(";")},f={__parse:function(e){var t,n,r,i,o=0,a={},u="",s="";if(!e)return a;do{for(n=e[o],t=++o,i=o;n+t>i;i++,o++)u+=String.fromCharCode(e[i]);if(r=e[o],t=++o,"status"==u||"flag"==u)for(i=o;r+t>i;i++,o++)s+=e[i];else{s=e.slice(i,r+t);try{s=g(s)}catch(c){s=""}o+=r}a[u]=s,u="",s=""}while(o<e.length);return a},decode:function(e){var t,n=[],r=e.substr(0,3),i=decodeURIComponent(e.substr(3));switch(r){case"002":return n=l.decode(i,"subp_v2","array"),f.__parse(n);case"003":return t=i.substr(0,1),i=i.substr(1),n=l.decode(i,"subp_v3_"+t,"array"),f.__parse(n);default:return decodeURIComponent(e)}}},l={encode:function(e){if(e=""+e,""==e)return"";var t,n,r,i,o,a="",u="",s="",c=0;do t=e.charCodeAt(c++),n=e.charCodeAt(c++),u=e.charCodeAt(c++),r=t>>2,i=(3&t)<<4|n>>4,o=(15&n)<<2|u>>6,s=63&u,isNaN(n)?o=s=64:isNaN(u)&&(s=64),a=a+this._keys.charAt(r)+this._keys.charAt(i)+this._keys.charAt(o)+this._keys.charAt(s),t=n=u="",r=i=o=s="";while(c<e.length);return a},decode:function(e,t,n){var r=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};"string"==typeof e&&(e=e.split(""));var i,o,a,u,s,c=[],d="",f="";e.length%4!=0;var l=/[^A-Za-z0-9+\/=]/,g=this._keys.split("");"urlsafe"==t&&(l=/[^A-Za-z0-9-_=]/,g=this._keys_urlsafe.split("")),"subp_v2"==t&&(l=/[^A-Za-z0-9_=-]/,g=this._subp_v2_keys.split("")),"subp_v3_3"==t&&(l=/[^A-Za-z0-9-_.-]/,g=this._subp_v3_keys_3.split(""));var p=0;if("binnary"==t)for(g=[],p=0;64>=p;p++)g[p]=p+128;if("binnary"!=t&&l.test(e.join("")))return"array"==n?[]:"";p=0;do a=r(g,e[p++]),u=r(g,e[p++]),s=r(g,e[p++]),f=r(g,e[p++]),i=a<<2|u>>4,o=(15&u)<<4|s>>2,d=(3&s)<<6|f,c.push(i),64!=s&&-1!=s&&c.push(o),64!=f&&-1!=f&&c.push(d),i=o=d="",a=u=s=f="";while(p<e.length);if("array"==n)return c;for(var m="",v=0;v<c.lenth;v++)m+=String.fromCharCode(c[v]);return m},_keys:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keys_urlsafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",_subp_v2_keys:"uAL715W8e3jJCcNU0lT_FSXVgxpbEDdQ4vKaIOH2GBPtfzqsmYZo-wRM9i6hynrk=",_subp_v3_keys_3:"5WFh28sGziZTeS1lBxCK-HgPq9IdMUwknybo.LJrQD3uj_Va7pE0XfcNR4AOYvm6t"},g=function(e){for(var t="",n=0;n<e.length;n++)t+="%"+p(e[n]);return decodeURIComponent(t)},p=function(e){var t="0"+e.toString(16);return t.length<=2?t:t.substr(1)};e(function(){getUserInfo(function(e){e.uid?n(e.uid):n()},!0)})}function t(){function e(e){function t(){clearTimeout(i)}function n(){return(new Date).getTime()}function r(){var r=n(),i=r-o-200;o=r,i>3e3&&(t(),e&&e())}var i,o;o=n(),i=setInterval(r,800)}var t={set:function(e,t,n,r,i){var o=[];if(o.push(e+"="+t),n){var a=new Date,u=a.getTime()+36e5*n;a.setTime(u),o.push("expires="+a.toGMTString())}r&&o.push("path="+r),i&&o.push("domain="+i),document.cookie=o.join(";")},getRecord:function(){var e=window.getCookie("historyRecord")||"";return window.historyRecord=e=e?JSON.parse(e):e,e},setRecord:function(){var e={href:window.location.href,refer:document.referrer};t.set("historyRecord",JSON.stringify(e),24,"/",".sina.cn")}};t.setRecord(),(-1!=window.location.href.indexOf("//sina.cn")||window.sudaLogConfig&&sudaLogConfig.backOff)&&e(function(){var n=t.getRecord();if(n&&-1==n.href.indexOf("//sina.cn"))var r=n.href;else var r="";SUDA.log("","twice","",r),sinaSax&&sinaSax.callback("saxHistory"),e(function(){SUDA.log("","twice","",r),sinaSax&&sinaSax.callback("saxHistory")})})}function n(e,t,n){var r="https:"==window.location.protocol?"https://r.dmp.sina.cn":"http://cm.dmp.sina.cn";setTimeout(function(){var i=e.getElementsByTagName(t)[0];e.getElementById(n)||(t=e.createElement(t),t.id=n,t.setAttribute("charset","utf-8"),t.src=r+"/cm/sinaads_ck_wap.js",i.parentNode.insertBefore(t,i))},1e3)}function r(){function e(e){function t(e){var t={};if(e){for(var n=e.split("&"),r=0;r<n.length;r++){var i=n[r].split("=");i&&(t[i[0]]=i[1])}return t}return t}for(var r=0;r<e.length;r++){var i=e[r],o=i.getAttribute("href");if(o&&-1!=o.indexOf("http")){var a=o.lastIndexOf("?"),u=a>-1,s=u?o.slice(a+1):"",c=t(s);c.wm||(o=u?o:o+"?",o=o+"&wm="+n,o=o.replace("?&","?"),i.setAttribute("href",o))}}}function t(e,t){var n=new RegExp(t+"=(.*?)(&|$)"),r=e.match(n);return null!=r?r[1]:""}if(-1!=window.location.href.indexOf("wm")){var n=t(window.location.href,"wm");document.addEventListener("DOMNodeInserted",function(t){switch(t.target.tagName){case void 0:return;case"A":var n=[t.target];break;default:var n=t.target.querySelectorAll("a")}e(n)},!1)}}function i(){e(),t(),n(document,"script","sinaads-ck-script"),r()}return{init:i}});
//# sourceMappingURL=suda_log.js.map